local VERSION = "2.5.5"

local players = game:GetService("Players")
local localPlayer = players.LocalPlayer
local replicatedStorage = game:GetService("ReplicatedStorage")
local textChatService = game:GetService("TextChatService")
local StarterGui = game:GetService("StarterGui")

local selectedLanguage = nil
local isSending = false

-- Chat sending function (supports old/new chat)
local oldChat
if textChatService.ChatVersion == Enum.ChatVersion.TextChatService then
    oldChat = false
else
    oldChat = true
end

local function Chat(msg)
    if not oldChat then
        textChatService.TextChannels.RBXGeneral:SendAsync(msg)
    else
        replicatedStorage.DefaultChatSystemChatEvents.SayMessageRequest:FireServer(msg, "All")
    end
end

-- Notify function (using StarterGui:SetCore for system notification)
local function notify(title, text, duration)
    StarterGui:SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = duration or 5
    })
end

-- Language alphabets map
local alphabets = {
    ["1"] = { -- Chinese example: just simplified replacements
        A = "阿", B = "比", C = "西", D = "迪", E = "伊", F = "艾弗", G = "吉",
        H = "艾尺", I = "艾", J = "杰", K = "开", L = "艾勒", M = "艾姆", N = "艾娜",
        O = "哦", P = "屁", Q = "吉吾", R = "艾儿", S = "艾丝", T = "提", U = "优",
        V = "维", W = "豆贝尔维", X = "艾克斯", Y = "吾艾", Z = "贼德"
    },
    ["2"] = { -- Russian alphabet (transliteration)
        A = "А", B = "Б", C = "Ц", D = "Д", E = "Е", F = "Ф", G = "Г",
        H = "Х", I = "И", J = "Й", K = "К", L = "Л", M = "М", N = "Н",
        O = "О", P = "П", Q = "Ку", R = "Р", S = "С", T = "Т", U = "У",
        V = "В", W = "Вэ", X = "Икс", Y = "Ы", Z = "З"
    },
    ["3"] = { -- Japanese Hiragana (approximate sounds)
        A = "あ", B = "び", C = "し", D = "で", E = "え", F = "ふ", G = "ぐ",
        H = "は", I = "い", J = "じ", K = "く", L = "る", M = "む", N = "ん",
        O = "お", P = "ぷ", Q = "きゅ", R = "る", S = "す", T = "と", U = "う",
        V = "ゔ", W = "わ", X = "っくす", Y = "い", Z = "ず"
    }
}

-- Translate each letter in message according to selected language
local function translateMessageLetters(msg, lang)
    local map = alphabets[lang]
    if not map then return msg end

    local result = {}
    for i = 1, #msg do
        local c = msg:sub(i,i)
        local upper = c:upper()
        if map[upper] then
            -- Keep case: use mapped character (mostly uppercase replaced)
            -- but we don't handle lowercase differently here to keep simple
            table.insert(result, map[upper])
        else
            table.insert(result, c)
        end
    end
    return table.concat(result)
end

-- Show initial prompt to pick language
notify("Language Selection", "Hello! Pick your language:\n1 - Chinese\n2 - Russian\n3 - Japanese", 10)

-- Chat event
localPlayer.Chatted:Connect(function(msg)
    if isSending then
        -- Ignore messages sent by script itself
        isSending = false
        return
    end

    if not selectedLanguage then
        if msg == "1" or msg == "2" or msg == "3" then
            selectedLanguage = msg
            notify("Language Selected", "You chose option " .. selectedLanguage .. ". Your chat will now be translated.", 5)
            isSending = true
            Chat("You selected language option " .. selectedLanguage .. ". Chat messages will be translated.")
        else
            notify("Invalid Selection", "Please type 1, 2, or 3 to pick your language.", 5)
        end
    else
        local translatedMsg = translateMessageLetters(msg, selectedLanguage)
        isSending = true
        Chat(translatedMsg)
    end
end)
